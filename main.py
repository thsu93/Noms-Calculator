import noms
import tkinter
import json
from noms.objects.food import NewMeal
from noms.objects.diary import Diary

client = noms.Client("aOcV0EPxHSAA0bBdFB6b6smqiThjul1LLgiHIDGf")

query = ""
meal_list = []
diary = Diary()

#TODO fix the cycle
while query != "Exit":

    query =  input("Find your food: ")

    search_results = client.search_query(query)
    print(search_results)
    
    if search_results.json:
        
        num_query =  int(input("Select result: "))

        if num_query in range(1,len(search_results.json["items"])+1):
            #TODO handle exceptions better    
            selected_item = search_results.get_result(num_query)
            
            value_query = input("How much? (in grams): ")
            
            #TODO
            #Why is this API call so slow
            #Returns list of food objects
            
            new_food_data = client.get_foods({str(selected_item["fdcId"]):int(value_query)})
            
            new_meal = NewMeal(new_food_data, value_query)
            new_meal.show_nutrients()
            
            diary.addMeal(new_meal)

        else:
            print("Invalid result, returning to selection.")
    
save = input("Do you want to save? (Y/N)")
if save == "Y" or save == "y":
    out_file = open("meals.json", "w")
  
    json.dump(diary.days, out_file, indent = 6)
    
    out_file.close()

    # #TODO improper closure in json
        #how to save the files properly and cleanly
        #how to read back in
    
    
    #Respond to the 
    


# nutrients = client.get_foods({'167755':100})
# print(nutrients.name())



# {'fdcId': 171030, 'description': 'Oil, walnut', 'lowercaseDescription': 'oil, walnut', 'commonNames': '', 'additionalDescriptions': '', 'dataType': 'SR Legacy', 'ndbNumber': 4528, 
# 'publishedDate': '2019-04-01', 'foodCategory': 'Fats and Oils', 'allHighlightFields': '', 'score': 394.31543, 'foodNutrients': [{'nutrientId': 1186, 'nutrientName': 'Folic acid', 
# 'nutrientNumber': '431', 'unitName': 'UG', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, such as fiber in meat)',
# 'value': 0.0}, {'nutrientId': 1110, 'nutrientName': 'Vitamin D (D2 + D3), International Units', 'nutrientNumber': '324', 'unitName': 'IU', 'derivationCode': 'Z', 
# 'derivationDescription': 'Assumed zero (Insignificant amount or not nat   urally occurring in a food, such as fiber in meat)', 'value': 0.0}, {'nutrientId': 1098, 'nutrientName': 'Copper, Cu', 'nutrientNumber': '312', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1246, 'nutrientName': 'Vitamin B-12, added', 'nutrientNumber': '578', 'unitName': 'UG', 'derivationCode': 'NR', 'derivationDescription': 'Nutrient that is based on other nutrient/s; value used directly, ex. Nut.#204 from Nut.#298', 'value': 0.0}, {'nutrientId': 1242, 'nutrientName': 'Vitamin E, added', 'nutrientNumber': '573', 'unitName': 'MG', 'derivationCode': 'NR', 'derivationDescription': 'Nutrient that is based on other nutrient/s; value 
# used directly, ex. Nut.#204 from Nut.#298', 'value': 0.0}, {'nutrientId': 1109, 'nutrientName': 'Vitamin E (alpha-tocopherol)', 'nutrientNumber': '323', 'unitName': 'MG', 'value': 0.4}, {'nutrientId': 1008, 'nutrientName': 'Energy', 'nutrientNumber': '208', 'unitName': 'KCAL', 'derivationCode': 'NC', 'derivationDescription': 'Calculated', 'value': 884}, {'nutrientId': 1180, 'nutrientName': 'Choline, total', 'nutrientNumber': '421', 'unitName': 'MG', 'value': 0.4}, {'nutrientId': 1198, 'nutrientName': 'Betaine', 'nutrientNumber': '454', 'unitName': 'MG', 'derivationCode': 'A', 'derivationDescription': 'Analytical', 'value': 0.0}, {'nutrientId': 1062, 'nutrientName': 'Energy', 'nutrientNumber': '268', 'unitName': 'kJ', 'value': 3700.0}, {'nutrientId': 1185, 'nutrientName': 'Vitamin K (phylloquinone)', 'nutrientNumber': '430', 'unitName': 'UG', 'derivationCode': 'T', 'derivationDescription': 'Taken from another source--other tables of food composition', 'value': 15.0}, {'nutrientId': 1212, 'nutrientName': 'Isoleucine', 'nutrientNumber': '503', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1213, 'nutrientName': 'Leucine', 'nutrientNumber': '504', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1214, 'nutrientName': 'Lysine', 'nutrientNumber': '505', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1216, 'nutrientName': 'Cystine', 'nutrientNumber': '507', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1219, 'nutrientName': 'Valine', 'nutrientNumber': '510', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1220, 'nutrientName': 'Arginine', 'nutrientNumber': '511', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1221, 'nutrientName': 'Histidine', 'nutrientNumber': '512', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1223, 'nutrientName': 'Aspartic acid', 'nutrientNumber': '514', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1227, 'nutrientName': 'Serine', 'nutrientNumber': 
# '518', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1259, 'nutrientName': 'SFA 4:0', 'nutrientNumber': '607', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1260, 'nutrientName': 'SFA 6:0', 'nutrientNumber': '608', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1262, 'nutrientName': 'SFA 10:0', 'nutrientNumber': '610', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1265, 'nutrientName': 'SFA 16:0', 'nutrientNumber': '613', 'unitName': 'G', 'value': 7.0}, {'nutrientId': 1266, 'nutrientName': 'SFA 18:0', 'nutrientNumber': '614', 'unitName': 'G', 'value': 2.0}, {'nutrientId': 1268, 'nutrientName': 'MUFA 18:1', 'nutrientNumber': '617', 'unitName': 'G', 'value': 22.2}, {'nutrientId': 1269, 'nutrientName': 'PUFA 18:2', 'nutrientNumber': '618', 'unitName': 'G', 'value': 52.9}, {'nutrientId': 1270, 'nutrientName': 'PUFA 18:3', 'nutrientNumber': '619', 'unitName': 'G', 'value': 10.4}, {'nutrientId': 1271, 'nutrientName': 'PUFA 20:4', 'nutrientNumber': '620', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1276, 'nutrientName': 'PUFA 18:4', 'nutrientNumber': '627', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1277, 'nutrientName': 'MUFA 20:1', 'nutrientNumber': '628', 'unitName': 'G', 'value': 0.4}, {'nutrientId': 1279, 'nutrientName': 'MUFA 22:1', 'nutrientNumber': '630', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1292, 'nutrientName': 'Fatty acids, total monounsaturated', 'nutrientNumber': '645', 'unitName': 'G', 'value': 22.8}, {'nutrientId': 1293, 'nutrientName': 'Fatty acids, total polyunsaturated', 'nutrientNumber': '646', 'unitName': 'G', 'value': 63.3}, {'nutrientId': 1004, 'nutrientName': 'Total lipid (fat)', 'nutrientNumber': '204', 'unitName': 'G', 'value': 100}, {'nutrientId': 1005, 'nutrientName': 'Carbohydrate, by difference', 'nutrientNumber': '205', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1051, 'nutrientName': 'Water', 'nutrientNumber': '255', 
# 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1087, 'nutrientName': 'Calcium, Ca', 'nutrientNumber': '301', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1092, 'nutrientName': 'Potassium, K', 'nutrientNumber': '306', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1095, 'nutrientName': 'Zinc, Zn', 'nutrientNumber': '309', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1167, 'nutrientName': 'Niacin', 'nutrientNumber': '406', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1170, 'nutrientName': 'Pantothenic acid', 'nutrientNumber': '410', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1175, 'nutrientName': 'Vitamin B-6', 'nutrientNumber': '415', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1178, 
# 'nutrientName': 'Vitamin B-12', 'nutrientNumber': '418', 'unitName': 'UG', 'value': 0.0}, {'nutrientId': 1079, 'nutrientName': 'Fiber, total dietary', 'nutrientNumber': '291', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1089, 'nutrientName': 'Iron, Fe', 'nutrientNumber': '303', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1090, 'nutrientName': 'Magnesium, Mg', 'nutrientNumber': '304', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1091, 'nutrientName': 'Phosphorus, P', 'nutrientNumber': '305', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1093, 'nutrientName': 'Sodium, Na', 'nutrientNumber': '307', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1162, 'nutrientName': 'Vitamin C, total ascorbic acid', 'nutrientNumber': '401', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1165, 'nutrientName': 'Thiamin', 'nutrientNumber': '404', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1166, 'nutrientName': 'Riboflavin', 'nutrientNumber': '405', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1253, 'nutrientName': 'Cholesterol', 'nutrientNumber': '601', 'unitName': 'MG', 'value': 0.0}, {'nutrientId': 1258, 'nutrientName': 'Fatty acids, total saturated', 'nutrientNumber': '606', 'unitName': 'G', 'value': 9.1}, {'nutrientId': 1261, 'nutrientName': 'SFA 8:0', 'nutrientNumber': '609', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1263, 'nutrientName': 'SFA 12:0', 'nutrientNumber': '611', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1264, 'nutrientName': 'SFA 14:0', 'nutrientNumber': '612', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1272, 'nutrientName': 'PUFA 22:6 n-3 (DHA)', 'nutrientNumber': '621', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1275, 'nutrientName': 'MUFA 16:1', 'nutrientNumber': '626', 'unitName': 'G', 'value': 0.1}, {'nutrientId': 1278, 'nutrientName': 'PUFA 2:5 n-3 (EPA)', 'nutrientNumber': '629', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1280, 'nutrientName': 'PUFA 22:5 n-3 (DPA)', 'nutrientNumber': '631', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1283, 'nutrientName': 'Phytosterols', 'nutrientNumber': '636', 'unitName': 'MG', 'value': 176}, {'nutrientId': 1210, 'nutrientName': 'Tryptophan', 'nutrientNumber': '501', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1211, 'nutrientName': 'Threonine', 'nutrientNumber': '502', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1215, 'nutrientName': 'Methionine', 'nutrientNumber': '506', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1217, 'nutrientName': 'Phenylalanine', 'nutrientNumber': '508', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1218, 'nutrientName': 'Tyrosine', 'nutrientNumber': '509', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1222, 'nutrientName': 'Alanine', 'nutrientNumber': '513', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1224, 'nutrientName': 'Glutamic acid', 'nutrientNumber': '515', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1225, 'nutrientName': 'Glycine', 'nutrientNumber': '516', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1226, 'nutrientName': 'Proline', 'nutrientNumber': '517', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1003, 'nutrientName': 'Protein', 'nutrientNumber': '203', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1007, 'nutrientName': 'Ash', 'nutrientNumber': '207', 'unitName': 'G', 'value': 0.0}, {'nutrientId': 1105, 'nutrientName': 'Retinol', 'nutrientNumber': '319', 'unitName': 'UG', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, such as fiber in meat)', 'value': 0.0}, {'nutrientId': 1190, 'nutrientName': 'Folate, DFE', 'nutrientNumber': '435', 'unitName': 'UG', 'derivationCode': 'NC', 'derivationDescription': 'Calculated', 'value': 0.0}, {'nutrientId': 1123, 'nutrientName': 'Lutein + zeaxanthin', 'nutrientNumber': '338', 'unitName': 'UG', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, such as fiber in meat)', 'value': 0.0}, {'nutrientId': 1057, 'nutrientName': 'Caffeine', 'nutrientNumber': '262', 'unitName': 'MG', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, such as fiber in meat)', 'value': 0.0}, {'nutrientId': 1058, 'nutrientName': 'Theobromine', 'nutrientNumber': '263', 'unitName': 'MG', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, such as fiber in meat)', 'value': 0.0}, {'nutrientId': 2000, 'nutrientName': 'Sugars, total including NLEA', 'nutrientNumber': '269', 'unitName': 'G', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, such as fiber in meat)', 'value': 0.0}, {'nutrientId': 1187, 'nutrientName': 'Folate, food', 'nutrientNumber': '432', 'unitName': 'UG', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, such as fiber in meat)', 'value': 0.0}, {'nutrientId': 1106, 'nutrientName': 'Vitamin A, RAE', 'nutrientNumber': '320', 'unitName': 'UG', 'derivationCode': 'NC', 'derivationDescription': 'Calculated', 'value': 0.0}, {'nutrientId': 1107, 'nutrientName': 'Carotene, beta', 'nutrientNumber': '321', 'unitName': 'UG', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, such as fiber in meat)', 'value': 0.0}, {'nutrientId': 1108, 'nutrientName': 'Carotene, alpha', 'nutrientNumber': '322', 'unitName': 'UG', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, such as fiber in meat)', 'value': 0.0}, {'nutrientId': 1177, 'nutrientName': 'Folate, total', 'nutrientNumber': '417', 'unitName': 'UG', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, such as fiber in meat)', 'value': 0.0}, {'nutrientId': 1104, 'nutrientName': 'Vitamin A, IU', 'nutrientNumber': '318', 'unitName': 'IU', 'value': 0.0}, {'nutrientId': 1120, 'nutrientName': 'Cryptoxanthin, beta', 'nutrientNumber': '334', 'unitName': 'UG', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, such as fiber in meat)', 'value': 0.0}, {'nutrientId': 1122, 'nutrientName': 'Lycopene', 'nutrientNumber': '337', 'unitName': 'UG', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, such as fiber in meat)', 'value': 0.0}, {'nutrientId': 1018, 'nutrientName': 'Alcohol, ethyl', 'nutrientNumber': '221', 'unitName': 'G', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, such as fiber in meat)', 'value': 0.0}, {'nutrientId': 1114, 'nutrientName': 'Vitamin D (D2 + D3)', 'nutrientNumber': '328', 'unitName': 'UG', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, such as fiber in meat)', 'value': 0.0}, {'nutrientId': 1103, 'nutrientName': 'Selenium, Se', 'nutrientNumber': '317', 'unitName': 'UG', 'derivationCode': 'Z', 'derivationDescription': 'Assumed zero (Insignificant amount or not naturally occurring in a food, 
# such as fiber in meat)', 'value': 0.0}]} 

# [{'value': 7.65, 'name': 'Protein', 'unit': 'g', 'nutrient_id': 203.0}, {'value': 29.66, 'name': 'Fat', 'unit': 'g', 'nutrient_id': 204.0}, {'value': 59.4, 'name': 'Carbs', 'unit': 'g', 'nutrient_id': 205.0}, {'value': 535.0, 
# 'name': 'Calories', 'unit': 'kcal', 'nutrient_id': 208.0}, {'value': 1.5, 'name': 'Water', 'unit': 'g', 'nutrient_id': 255.0}, {'value': 20.0, 'name': 'Caffeine', 'unit': 'mg', 'nutrient_id': 262.0}, {'value': 205.0, 'name': 'Theobromine', 'unit': 'mg', 'nutrient_id': 263.0}, {'value': 51.5, 'name': 'Sugar', 'unit': 'g', 'nutrient_id': 269.0}, {'value': 3.4, 'name': 'Fiber', 'unit': 'g', 'nutrient_id': 291.0}, {'value': 189.0, 'name': 'Calcium', 'unit': 'mg', 'nutrient_id': 301.0}, {'value': 2.35, 'name': 'Iron', 'unit': 'mg', 'nutrient_id': 303.0}, {'value': 63.0, 'name': 'Magnesium', 'unit': 'mg', 'nutrient_id': 304.0}, {'value': 208.0, 'name': 'Phosphorus', 'unit': 'mg', 'nutrient_id': 305.0}, {'value': 372.0, 'name': 'Potassium', 'unit': 'mg', 'nutrient_id': 306.0}, {'value': 79.0, 'name': 'Sodium', 'unit': 'mg', 'nutrient_id': 307.0}, {'value': 2.3, 'name': 'Zinc', 'unit': 'mg', 'nutrient_id': 309.0}, {'value': 0.491, 'name': 'Copper', 'unit': 'mg', 'nutrient_id': 312.0}, {'nutrient_id': 313, 'name': 'Fluoride', 'group': 'Minerals', 'unit': 'µg', 'value': 0.0}, {'nutrient_id': 315, 'name': 'Manganese', 'group': 'Minerals', 'unit': 'mg', 'value': 0.0}, {'value': 4.5, 'name': 'Selenium', 'unit': 'µg', 'nutrient_id': 317.0}, {'nutrient_id': 318, 'name': 'Vitamin A', 'group': 'Vitamins', 'unit': 'IU', 'value': 0.0}, {'value': 0.51, 'name': 'Vitamin E', 'unit': 'mg', 'nutrient_id': 323.0}, {'nutrient_id': 324, 'name': 'Vitamin D', 'group': 'Vitamins', 'unit': 'IU', 'value': 0.0}, {'value': 0.0, 'name': 'Vitamin C', 'unit': 'mg', 'nutrient_id': 401.0}, {'value': 0.112, 'name': 'Vitamin B-1', 'unit': 'mg', 'nutrient_id': 404.0}, {'value': 0.298, 'name': 'Vitamin B-2', 'unit': 'mg', 'nutrient_id': 405.0}, {'value': 0.386, 'name': 'Vitamin B-3', 'unit': 'mg', 'nutrient_id': 406.0}, {'nutrient_id': 410, 'name': 'Vitamin B-5', 'group': 'Vitamins', 'unit': 'mg', 'value': 0.0}, {'value': 0.036, 'name': 'Vitamin B-6', 'unit': 'mg', 'nutrient_id': 415.0}, {'value': 12.0, 'name': 'Vitamin B-9', 'unit': 'µg', 'nutrient_id': 417.0}, {'value': 0.75, 'name': 'Vitamin B-12', 'unit': 'µg', 'nutrient_id': 418.0}, {'value': 46.1, 'name': 'Choline', 'unit': 'mg', 'nutrient_id': 421.0}, {'value': 5.7, 'name': 'Vitamin K', 'unit': 'µg', 'nutrient_id': 430.0}, {'value': 23.0, 'name': 'Cholesterol', 'unit': 'mg', 'nutrient_id': 601.0}, {'nutrient_id': 605, 'name': 'Trans Fat', 'group': 'Lipids', 'unit': 'g', 'value': 0.0}, {'value': 18.509, 'name': 'Saturated Fat', 
# 'unit': 'g', 'nutrient_id': 606.0}, {'value': 0.0, 'name': 'DHA', 'unit': 'g', 'nutrient_id': 621.0}, {'value': 0.0, 'name': 'EPA', 'unit': 'g', 'nutrient_id': 629.0}, {'value': 7.186, 'name': 'Monounsaturated Fat', 'unit': 'g', 'nutrient_id': 645.0}, {'value': 1.376, 'name': 'Polyunsaturated Fat', 'unit': 'g', 'nutrient_id': 646.0}, {'nutrient_id': 851, 'name': 'ALA', 'group': 'Lipids', 'unit': 'g', 'value': 0.0}]
